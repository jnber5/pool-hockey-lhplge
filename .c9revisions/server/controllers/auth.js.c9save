{"ts":1377632238761,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var passport =  require('passport')\n    , User = require('../models/User.js');\n\nmodule.exports = {\n    register: function(req, res, next) {\n        try {\n            User.validate(req.body);\n        }\n        catch(err) {\n            return res.send(400, err.message);\n        }\n\n        User.addUser(req.body.username, req.body.password, req.body.role, function(err, user) {\n            if(err === 'UserAlreadyExists') return res.send(403, \"User already exists\");\n            else if(err)                    return res.send(500);\n\n            req.logIn(user, function(err) {\n                if(err)     { next(err); }\n                else        { res.json(200, { \"role\": user.role, \"username\": user.username }); }\n            });\n        });\n    },\n\n    login: function(req, res, next) {\n        passport.authenticate('local', function(err, user) {\n\n            if(err)     { return next(err); }\n            if(!user)   { return res.send(400); }\n\n\n            req.logIn(user, function(err) {\n                if(err) {\n                    return next(err);\n                }\n\n                if(req.body.rememberme) req.session.cookie.maxAge = 1000 * 60 * 60 * 24 * 7;\n                res.json(200, { \"role\": user.role, \"username\": user.username });\n            });\n        })(req, res, next);\n    },\n\n    logout: function(req, res) {\n        req.logout();\n        res.send(200);\n    }\n};"]],"start1":0,"start2":0,"length1":0,"length2":1389}]],"length":1389}
{"contributors":[],"silentsave":false,"ts":1377632334917,"patch":[[{"diffs":[[0,"ser.username"],[1,", \"id\": user._id, \"franchise\": user.franchise._id, \"email\": user.email"],[0," }); }\n     "]],"start1":697,"start2":697,"length1":24,"length2":94}]],"length":1459,"saved":false}
{"ts":1377634313910,"patch":[[{"diffs":[[0,"name"],[-1,", \"id\": user._id, \"franchise\": user.franchise._id, \"email\": user.email"],[0," });"]],"start1":705,"start2":705,"length1":78,"length2":8}]],"length":1389,"saved":false}
{"contributors":[],"silentsave":false,"ts":1377695845128,"patch":[[{"diffs":[[0," user) {"],[1,"\n            \n            console.log(user);"],[0,"\n\n      "]],"start1":842,"start2":842,"length1":16,"length2":60}]],"length":1433,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378307699421,"patch":[[{"diffs":[[0,"    "],[-1,"console.log("],[1,"\n            console.log('Ã©tape 1 :' + "],[0,"user"]],"start1":872,"start2":872,"length1":20,"length2":47},{"diffs":[[0,"00); }\n\n"],[-1,"\n"],[0,"        "]],"start1":1012,"start2":1012,"length1":17,"length2":16},{"diffs":[[0,"              }\n"],[1,"                "],[0,"\n"],[-1,""],[0,"                "]],"start1":1130,"start2":1130,"length1":33,"length2":49},{"diffs":[[0,"24 * 7;\n"],[-1,""],[0,"        "]],"start1":1248,"start2":1248,"length1":16,"length2":16},{"diffs":[[0,"ser.username"],[1,", \"id\": user._id, \"franchise\": user.franchise, \"email\": user.email"],[0," });\n       "]],"start1":1320,"start2":1320,"length1":24,"length2":90}]],"length":1541,"saved":false}
