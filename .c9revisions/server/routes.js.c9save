{"ts":1377632440865,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var _ =           require('underscore')\n    , path =      require('path')\n    , passport =  require('passport')\n    , AuthCtrl =  require('./controllers/auth')\n    , UserCtrl =  require('./controllers/user')\n    , User =      require('./models/User.js')\n    , userRoles = require('../client/js/routingConfig').userRoles\n    , accessLevels = require('../client/js/routingConfig').accessLevels;\n\nvar routes = [\n\n    // Views\n    {\n        path: '/partials/*',\n        httpMethod: 'GET',\n        middleware: [function (req, res) {\n            var requestedView = path.join('./', req.url);\n            res.render(requestedView);\n        }]\n    },\n\n    // OAUTH\n    {\n        path: '/auth/twitter',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('twitter')]\n    },\n    {\n        path: '/auth/twitter/callback',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('twitter', {\n            successRedirect: '/',\n            failureRedirect: '/login'\n        })]\n    },\n    {\n        path: '/auth/facebook',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('facebook')]\n    },\n    {\n        path: '/auth/facebook/callback',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('facebook', {\n            successRedirect: '/',\n            failureRedirect: '/login'\n        })]\n    },\n    {\n        path: '/auth/google',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('google')]\n    },\n    {\n        path: '/auth/google/return',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('google', {\n            successRedirect: '/',\n            failureRedirect: '/login'\n        })]\n    },\n    {\n        path: '/auth/linkedin',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('linkedin')]\n    },\n    {\n        path: '/auth/linkedin/callback',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('linkedin', {\n            successRedirect: '/',\n            failureRedirect: '/login'\n        })]\n    },\n\n    // Local Auth\n    {\n        path: '/register',\n        httpMethod: 'POST',\n        middleware: [AuthCtrl.register]\n    },\n    {\n        path: '/login',\n        httpMethod: 'POST',\n        middleware: [AuthCtrl.login]\n    },\n    {\n        path: '/logout',\n        httpMethod: 'POST',\n        middleware: [AuthCtrl.logout]\n    },\n\n    // User resource\n    {\n        path: '/users',\n        httpMethod: 'GET',\n        middleware: [UserCtrl.index],\n        accessLevel: accessLevels.admin\n    },\n\n    // All other get requests should be handled by AngularJS's client-side routing system\n    {\n        path: '/*',\n        httpMethod: 'GET',\n        middleware: [function(req, res) {\n            var role = userRoles.public, username = '';\n            if(req.user) {\n                role = req.user.role;\n                username = req.user.username;\n            }\n            res.cookie('user', JSON.stringify({\n                'username': username,\n                'role': role\n            }));\n            res.render('index');\n        }]\n    }\n];\n\nmodule.exports = function(app) {\n\n    _.each(routes, function(route) {\n        route.middleware.unshift(ensureAuthorized);\n        var args = _.flatten([route.path, route.middleware]);\n\n        switch(route.httpMethod.toUpperCase()) {\n            case 'GET':\n                app.get.apply(app, args);\n                break;\n            case 'POST':\n                app.post.apply(app, args);\n                break;\n            case 'PUT':\n                app.put.apply(app, args);\n                break;\n            case 'DELETE':\n                app.delete.apply(app, args);\n                break;\n            default:\n                throw new Error('Invalid HTTP method specified for route ' + route.path);\n                break;\n        }\n    });\n}\n\nfunction ensureAuthorized(req, res, next) {\n    var role;\n    if(!req.user) role = userRoles.public;\n    else          role = req.user.role;\n\n    var accessLevel = _.findWhere(routes, { path: req.route.path }).accessLevel || accessLevels.public;\n\n    if(!(accessLevel.bitMask & role.bitMask)) return res.send(403);\n    return next();\n}"]],"start1":0,"start2":0,"length1":0,"length2":4182}]],"length":4182}
{"contributors":[],"silentsave":false,"ts":1377633882851,"patch":[[{"diffs":[[0,"ername;\n"],[1,"                \n"],[0,"        "]],"start1":2885,"start2":2885,"length1":16,"length2":33}]],"length":4199,"saved":false}
{"ts":1377634111044,"patch":[[{"diffs":[[0,"},\n\n"],[-1,"    // OAUTH\n    {\n        path: '/auth/twitter',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('twitter')]\n    },\n    {\n        path: '/auth/twitter/callback',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('twitter', {\n            successRedirect: '/',\n            failureRedirect: '/login'\n        })]\n    },\n    {\n        path: '/auth/facebook',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('facebook')]\n    },\n    {\n        path: '/auth/facebook/callback',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('facebook', {\n            successRedirect: '/',\n            failureRedirect: '/login'\n        })]\n    },\n    {\n        path: '/auth/google',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('google')]\n    },\n    {\n        path: '/auth/google/return',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('google', {\n            successRedirect: '/',\n            failureRedirect: '/login'\n        })]\n    },\n    {\n        path: '/auth/linkedin',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('linkedin')]\n    },\n    {\n        path: '/auth/linkedin/callback',\n        httpMethod: 'GET',\n        middleware: [passport.authenticate('linkedin', {\n            successRedirect: '/',\n            failureRedirect: '/login'\n        })]\n    },\n\n"],[0,"    "]],"start1":640,"start2":640,"length1":1408,"length2":8},{"diffs":[[0,"al Auth\n"],[1,""],[0,"    {\n  "]],"start1":654,"start2":654,"length1":16,"length2":16},{"diffs":[[0,"ername ="],[1," '', id = '', franchise ="],[0," '';\n   "]],"start1":1369,"start2":1369,"length1":16,"length2":41},{"diffs":[[0,"ername;\n"],[1,"                id = req.user.id;\n                franchise = req.user.franchise;\n"],[0,"        "]],"start1":1510,"start2":1510,"length1":16,"length2":98},{"diffs":[[0,"ername,\n"],[-1,""],[0,"        "]],"start1":1709,"start2":1709,"length1":16,"length2":16},{"diffs":[[0,"e': role"],[1,",\n                'id': id,\n                'franchise': franchise,\n                "],[0,"\n       "]],"start1":1737,"start2":1737,"length1":16,"length2":100}]],"length":2990,"saved":false}
{"ts":1377634116776,"patch":[[{"diffs":[[0,"nchise;\n"],[-1,"                \n"],[0,"        "]],"start1":1592,"start2":1592,"length1":33,"length2":16}]],"length":2973,"saved":false}
{"ts":1377634298121,"patch":[[{"diffs":[[0,"se ="],[1," '', email ="],[0," '';\n"],[-1,""],[0,"    "]],"start1":1398,"start2":1398,"length1":13,"length2":25},{"diffs":[[0,"nchise;\n"],[1,"                email = req.user.email;\n"],[0,"        "]],"start1":1604,"start2":1604,"length1":16,"length2":56},{"diffs":[[0,"nchise,\n"],[-1,""],[0,"        "]],"start1":1840,"start2":1840,"length1":16,"length2":16},{"diffs":[[0,"        "],[1,"'email': email"],[0,"\n       "]],"start1":1856,"start2":1856,"length1":16,"length2":30}]],"length":3039,"saved":false}
{"contributors":[],"silentsave":false,"ts":1377695173425,"patch":[[{"diffs":[[0,"req.user) {\n"],[1,"                console.log(user);\n"],[0,"            "]],"start1":1434,"start2":1434,"length1":24,"length2":59}]],"length":3074,"saved":false}
{"ts":1377695381192,"patch":[[{"diffs":[[0,"ole.log("],[1,"req."],[0,"user);\n "]],"start1":1466,"start2":1466,"length1":16,"length2":20}]],"length":3078,"saved":false}
{"ts":1377695950374,"patch":[[{"diffs":[[0,") {\n"],[-1,"                console.log(req.user);\n"],[0,"    "]],"start1":1442,"start2":1442,"length1":47,"length2":8}]],"length":3039,"saved":false}
{"contributors":[],"silentsave":false,"ts":1377697215164,"patch":[[{"diffs":[[0,"req.user) {\n"],[1,"                console.log('req.user : ' + req.user)\n"],[0,"            "]],"start1":1434,"start2":1434,"length1":24,"length2":78}]],"length":3093,"saved":false}
{"ts":1377698804561,"patch":[[{"diffs":[[0,") {\n"],[-1,"                console.log('req.user : ' + req.user)\n"],[0,"    "]],"start1":1442,"start2":1442,"length1":62,"length2":8}]],"length":3039,"saved":false}
{"contributors":[],"silentsave":false,"ts":1377729621687,"patch":[[{"diffs":[[0,"   });\n}"],[1,";"],[0,"\n\nfuncti"]],"start1":2694,"start2":2694,"length1":16,"length2":17}]],"length":3040,"saved":false}
{"ts":1377730396182,"patch":[[{"diffs":[[0,"ion(req, res) {\n"],[1,"            console.log(req);\n"],[0,"            var "]],"start1":1310,"start2":1310,"length1":32,"length2":62}]],"length":3070,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378232536387,"patch":[[{"diffs":[[0,"admin\n    },"],[1,"\n    \n    // User resource\n    {\n        path: '/franchises',\n        httpMethod: 'GET',\n        middleware: [FranchiseCtrl.index],\n        accessLevel: accessLevels.admin\n    },"],[0,"\n\n    // All"]],"start1":1127,"start2":1127,"length1":24,"length2":202},{"diffs":[[0,"    "],[-1,"console.log(req);"],[0,"\n   "]],"start1":1512,"start2":1512,"length1":25,"length2":8},{"diffs":[[0,"role"],[-1,",\n                'id': id,\n                'franchise': franchise,\n                'email': email"],[0,"\n   "]],"start1":1967,"start2":1967,"length1":106,"length2":8}]],"length":3133,"saved":false}
{"ts":1378232612666,"patch":[[{"diffs":[[0,": [UserCtrl."],[1,"f"],[0,"ind"],[-1,"ex"],[1,"All"],[0,"],\n        a"]],"start1":1073,"start2":1073,"length1":29,"length2":31},{"diffs":[[0,"iseCtrl."],[1,"f"],[0,"ind"],[-1,"ex"],[1,"All"],[0,"],\n     "]],"start1":1257,"start2":1257,"length1":21,"length2":23}]],"length":3137,"saved":false}
{"ts":1378232625211,"patch":[[{"diffs":[[0,"/user')\n"],[1,"    , FranchiseCtrl =  require('./controllers/user')\n"],[0,"    , Us"]],"start1":200,"start2":200,"length1":16,"length2":69}]],"length":3190,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378233614712,"patch":[[{"diffs":[[0,"('./controllers/"],[-1,"u"],[1,"franchi"],[0,"se"],[-1,"r"],[0,"')\n    , User = "]],"start1":238,"start2":238,"length1":36,"length2":41}]],"length":3195,"saved":false}
{"ts":1378234016701,"patch":[[{"diffs":[[0,"h')\n"],[-1,"    , passport =  require('passport')\n"],[0,"    "]],"start1":70,"start2":70,"length1":46,"length2":8},{"diffs":[[0,"e')\n"],[-1,"    , User =      require('./models/User.js')\n"],[0,"    "]],"start1":224,"start2":224,"length1":54,"length2":8}]],"length":3111,"saved":false}
{"ts":1378234939318,"patch":[[{"diffs":[[0,"franchise')\n"],[1,"    , PlayerCtrl =  require('./controllers/player')\n"],[0,"    , userRo"]],"start1":216,"start2":216,"length1":24,"length2":76},{"diffs":[[0,"   \n"],[-1,"    // User resource\n"],[0,"    {\n"],[1,""],[0,"    "]],"start1":1169,"start2":1169,"length1":35,"length2":14},{"diffs":[[0,"pMethod: 'GET',\n"],[-1,""],[0,"        middlewa"]],"start1":1219,"start2":1219,"length1":32,"length2":32},{"diffs":[[0,"admin\n    },"],[1,"\n    \n    {\n        path: '/players',\n        httpMethod: 'GET',\n        middleware: [PlayerCtrl.findAll],\n        accessLevel: accessLevels.admin\n    },"],[0,"\n\n    // All"]],"start1":1314,"start2":1314,"length1":24,"length2":177}]],"length":3295,"saved":false}
{"ts":1378236542465,"patch":[[{"diffs":[[0,": '/"],[1,"api/"],[0,"users',\n"],[-1,""],[0,"    "]],"start1":1042,"start2":1042,"length1":16,"length2":20},{"diffs":[[0,"path: '/"],[1,"api/"],[0,"franchis"]],"start1":1191,"start2":1191,"length1":16,"length2":20},{"diffs":[[0,"  },\n    \n    {\n"],[-1,""],[0,"        path: '/"]],"start1":1330,"start2":1330,"length1":32,"length2":32},{"diffs":[[0,"path: '/"],[1,"api/"],[0,"players'"]],"start1":1354,"start2":1354,"length1":16,"length2":20}]],"length":3307,"saved":false}
{"ts":1378236563831,"patch":[[{"diffs":[[0,"l: accessLevels."],[-1,"admin"],[1,"user"],[0,"\n    },\n    \n   "]],"start1":1143,"start2":1143,"length1":37,"length2":36},{"diffs":[[0,"l: accessLevels."],[-1,"admin"],[1,"user"],[0,"\n    },\n    \n   "]],"start1":1305,"start2":1305,"length1":37,"length2":36},{"diffs":[[0,"els."],[-1,"admin"],[1,"user"],[0,"\n   "]],"start1":1473,"start2":1473,"length1":13,"length2":12}]],"length":3304,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378418739388,"patch":[[{"diffs":[[0,"rs/player')\n"],[1,"    , TeamCtrl =    require('./controllers/team')\n    , DomainCtrl = require('./controllers/domain')\n"],[0,"    , userRo"]],"start1":268,"start2":268,"length1":24,"length2":125},{"diffs":[[0,"erRoles\n"],[-1,""],[0,"    , ac"]],"start1":439,"start2":439,"length1":16,"length2":16},{"diffs":[[0,"},\n\n"],[-1,"    // User resource\n"],[0,"    "]],"start1":1100,"start2":1100,"length1":29,"length2":8},{"diffs":[[0,"rCtrl.findAll],\n"],[-1,""],[0,"        accessLe"]],"start1":1507,"start2":1507,"length1":32,"length2":32},{"diffs":[[0,".user\n    },"],[1,"\n    \n    {\n        path: '/api/player/:id',\n        httpMethod: 'GET',\n        middleware: [PlayerCtrl.find],\n        accessLevel: accessLevels.user\n    },\n    \n    {\n        path: '/api/player',\n        httpMethod: 'POST',\n        middleware: [PlayerCtrl.add],\n        accessLevel: accessLevels.admin\n    },\n    \n    {\n        path: '/api/teams',\n        httpMethod: 'GET',\n        middleware: [TeamCtrl.findAll],\n        accessLevel: accessLevels.user\n    },\n    \n    {\n      path: '/api/domain/:name',\n      httpMethod: 'GET',\n      middleware: [DomainCtrl.find],\n      accessLevel: accessLevels.user\n    },"],[0,"\n\n    // All"]],"start1":1556,"start2":1556,"length1":24,"length2":635}]],"length":3995,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378423082752,"patch":[[{"diffs":[[0,"  },\n    \n    {\n"],[1,"        path: '/api/playerHistory',\n        httpMethod: 'POST',\n        middleware: [PlayerCtrl.addHistory],\n        accessLevel: accessLevels.admin\n    },\n    \n    {\n"],[0,"        path: '/"]],"start1":1873,"start2":1873,"length1":32,"length2":199}]],"length":4162,"saved":false}
{"ts":1378423801518,"patch":[[{"diffs":[[0,"  },\n    \n    {\n"],[1,"        path: '/api/playerHistory',\n        httpMethod: 'PUT',\n        middleware: [PlayerCtrl.endHistory],\n        accessLevel: accessLevels.admin\n    },\n    \n    {\n"],[0,"        path: '/"]],"start1":2040,"start2":2040,"length1":32,"length2":198}]],"length":4328,"saved":false}
{"ts":1378424303640,"patch":[[{"diffs":[[0,"  },\n    \n    {\n"],[1,"        path: '/api/playerSalaryy',\n        httpMethod: 'POST',\n        middleware: [PlayerCtrl.addSalary],\n        accessLevel: accessLevels.admin\n    },\n    \n    {\n"],[0,"        path: '/"]],"start1":2206,"start2":2206,"length1":32,"length2":198}]],"length":4494,"saved":false}
{"ts":1378434605575,"patch":[[{"diffs":[[0,"erSalary"],[-1,"y"],[0,"',\n     "]],"start1":2246,"start2":2246,"length1":17,"length2":16}]],"length":4493,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378661170726,"patch":[[{"diffs":[[0,"    {\n      "],[1,"  "],[0,"path: '/api/"]],"start1":2533,"start2":2533,"length1":24,"length2":26},{"diffs":[[0,"ame',\n      "],[1,"  "],[0,"httpMethod: "]],"start1":2568,"start2":2568,"length1":24,"length2":26},{"diffs":[[0,"hod: 'GET',\n"],[1,"  "],[0,"      middle"]],"start1":2589,"start2":2589,"length1":24,"length2":26},{"diffs":[[0,"Ctrl.find],\n"],[1,"        accessLevel: accessLevels.user\n    },\n    \n    {\n        path: '/api/contract/playersUnderContract/:franchise/:dateConsultation',\n        httpMethod: 'GET',\n        middleware: [ContractCtrl.playersUnderContract],\n        accessLevel: accessLevels.user\n    },\n    {\n        path: '/api/contract',\n        httpMethod: 'POST',\n        middleware: [ContractCtrl.add],\n  "],[0,"      access"]],"start1":2628,"start2":2628,"length1":24,"length2":399}]],"length":4874,"saved":false}
{"ts":1378661195238,"patch":[[{"diffs":[[0,"omain')\n"],[1,"    , ContractCtrl = require('./controllers/contract')\n"],[0,"    , us"]],"start1":373,"start2":373,"length1":16,"length2":71}]],"length":4929,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378664147334,"patch":[[{"diffs":[[0,"l: accessLevels."],[-1,"user"],[1,"admin"],[0,"\n    },\n\n    // "]],"start1":3086,"start2":3086,"length1":36,"length2":37}]],"length":4930,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378769817985,"patch":[[{"diffs":[[0,"  },\n    \n    {\n"],[1,"        path: '/api/franchise',\n        httpMethod: 'GET',\n        middleware: [FranchiseCtrl.find],\n        accessLevel: accessLevels.user\n    },\n    \n    {\n"],[0,"        path: '/"]],"start1":1463,"start2":1463,"length1":32,"length2":190}]],"length":5088,"saved":false}
{"ts":1378769823351,"patch":[[{"diffs":[[0,"ranchise"],[1,"/:id"],[0,"',\n     "]],"start1":1500,"start2":1500,"length1":16,"length2":20}]],"length":5092,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378772655771,"patch":[[{"diffs":[[0,"l: accessLevels."],[-1,"user"],[1,"anon"],[0,"\n    },\n    \n   "]],"start1":1440,"start2":1440,"length1":36,"length2":36}]],"length":5092,"saved":false}
{"ts":1378772723422,"patch":[[{"diffs":[[0,"l],\n"],[-1,"        accessLevel: accessLevels.anon\n"],[0,"    "]],"start1":1418,"start2":1418,"length1":47,"length2":8}]],"length":5053,"saved":false}
{"ts":1378777115413,"patch":[[{"diffs":[[0,"els.user\n    },\n"],[1,"    \n     {\n        path: '/api/contract/playersUnderContract/:dateConsultation',\n        httpMethod: 'GET',\n        middleware: [ContractCtrl.playersUnderContract],\n        accessLevel: accessLevels.user\n    },\n    \n"],[0,"    {\n        pa"]],"start1":3070,"start2":3070,"length1":32,"length2":249}]],"length":5270,"saved":false}
{"ts":1378777497501,"patch":[[{"diffs":[[0,"actCtrl."],[-1,"playersUnderContract"],[1,"findAll"],[0,"],\n     "]],"start1":3221,"start2":3221,"length1":36,"length2":23}]],"length":5257,"saved":false}
{"ts":1378778050686,"patch":[[{"diffs":[[0,"contract"],[-1,"/playersUnderContract"],[1,"s"],[0,"/:dateCo"]],"start1":3118,"start2":3118,"length1":37,"length2":17}]],"length":5237,"saved":false}
